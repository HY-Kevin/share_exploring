%测试信号生成code 检验37阶卡塞尔窗滤波器效果

k=16;
Fs = 10000000;%采样频率10MHz
len = 1000;
t = (0:len-1)/Fs;
y = sin(2*pi*1000000*t)+cos(2*pi*3000000*t);
% y = sin(2*pi*1000000*t)+sin(2*pi*3000000*t)+sin(2*pi*2500000*t);
plot(t,y);
y_ad = y/max(abs(y));
q_ad=round(y_ad*(2^(k-1)-1));%进行16bit量化，配合后续的FPGA实现
%将信号导入文件
fid=fopen('D:\ele_match\FPGA_filter\signal_in.txt','w');
for i = 1:len
    if q_ad(i) >= 0
        fprintf(fid,'%X\n', q_ad(i));
    else
        fprintf(fid,'%X\n', q_ad(i)+2^k);
    end
end
fclose(fid);

%滤波下看看效果 - 滤波系数需要在量化处理前下个断点然后贴过来
coeff =[-0.000670725257353326,-0.000792999076599835,0.000266038144856742,0.00242748622170168,0.00356423810419241,0.000966388550376318,-0.00522328831077981,-0.00991137450195772,-0.00608921327755592,0.00763839393725974,0.0216996619828801,0.0200433963479112,-0.00544243614741472,-0.0413925444277523,-0.0546325709158592,-0.0132631456339571,0.0859668556998134,0.206328460214929,0.288733383188963,0.288733383188963,0.206328460214929,0.0859668556998134,-0.0132631456339571,-0.0546325709158592,-0.0413925444277523,-0.00544243614741472,0.0200433963479112,0.0216996619828801,0.00763839393725974,-0.00608921327755592,-0.00991137450195772,-0.00522328831077981,0.000966388550376318,0.00356423810419241,0.00242748622170168,0.000266038144856742,-0.000792999076599835,-0.000670725257353326];
%生成的滤波系数
out =conv(y,coeff);%卷积

subplot(2,1,1);
plot(signal);
xlabel('滤波前');
axis([0 200 -4 4]);%调整横纵比
subplot(2,1,2);
plot(out);
xlabel('滤波后');
axis([0 200 -2 2]);
